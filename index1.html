<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Attendance Admin Panel</title>

<style>
/* =====================================================
  ðŸŒˆ GLOBAL THEME & VARIABLES
===================================================== */
:root {
  --bg: #eef2ff;
  --bg2: #f5f7ff;
  --card: rgba(255,255,255,0.8);
  --muted: #64748b;
  --accent: #6366f1;
  --accent2: #a855f7;
  --border: rgba(0,0,0,0.12);
  --danger: #ef4444;
  --success: #22c55e;
  --radius: 16px;
  --shadow-soft: 0 6px 22px rgba(0,0,0,0.08);
  --glass: rgba(255,255,255,0.35);
  --blur: blur(14px);
  color: #0f172a;
  font-family: "Inter", system-ui, sans-serif;
}

/* ================= DARK THEME ================= */
:root.dark {
  --bg: #0f172a;
  --bg2: #1e293b;
  --card: rgba(17,25,40,0.6);
  --muted: #94a3b8;
  --accent: #60a5fa;
  --accent2: #34d399;
  --border: rgba(255,255,255,0.12);
  --shadow-soft: 0 6px 22px rgba(0,0,0,0.65);
  --glass: rgba(255,255,255,0.05);
  --blur: blur(18px);
  color: #f1f5f9;
}

/* Background */
html, body {
  margin: 0;
  padding: 0;
  background: linear-gradient(145deg, var(--bg), var(--bg2));
  min-height: 100%;
  transition: background 0.3s ease, color 0.3s ease;
}

/* =====================================================
  ðŸ§Š CARD / LAYOUT
===================================================== */
.app {
  max-width: 1180px;
  margin: 30px auto;
  padding: 20px;
}

.card {
  background: var(--glass);
  backdrop-filter: var(--blur);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 22px;
  box-shadow: var(--shadow-soft);
  transition: 0.3s ease;
}

.card:hover {
  transform: translateY(-3px);
}

/* =====================================================
  ðŸŒŸ HEADERS
===================================================== */
h1 {
  margin: 0;
  font-size: 26px;
  background: linear-gradient(90deg, var(--accent), var(--accent2));
  -webkit-background-clip: text;
  color: transparent;
  font-weight: 800;
}
p.lead {
  color: var(--muted);
  margin: 0;
  font-size: 14px;
}
.badge-chip {
  display: inline-flex;
  gap: 6px;
  background: linear-gradient(135deg, rgba(99,102,241,0.15), rgba(168,85,247,0.12));
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 11px;
  border: 1px solid rgba(148,163,184,0.4);
}

/* =====================================================
  CONTROLS
===================================================== */
.controls {
  display: flex;
  gap: 8px;
  align-items: center;
  flex-wrap: wrap;
  justify-content: flex-end;
}

input[type="text"], select {
  padding: 10px 14px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: rgba(255,255,255,0.7);
  font-size: 14px;
  transition: 0.25s ease;
}

:root.dark input,
:root.dark select {
  background: rgba(255,255,255,0.08);
  color: white;
}

input:focus, select:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(99,102,241,0.3);
}

/* =====================================================
  ðŸ”µ BUTTONS
===================================================== */
.btn {
  padding: 9px 14px;
  border-radius: 10px;
  cursor: pointer;
  border: none;
  font-weight: 600;
  transition: 0.2s ease;
  font-size: 14px;
}

.btn.primary {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  color: white;
  box-shadow: 0 4px 14px rgba(99,102,241,0.45);
}

.btn.ghost {
  border: 1px solid var(--border);
  background: transparent;
  color: inherit;
}

/* =====================================================
  ðŸ“Š TABLE
===================================================== */
.table-wrap {
  margin-top: 16px;
  overflow-x: auto;
  border-radius: 14px;
  border: 1px solid var(--border);
  backdrop-filter: blur(10px);
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 12px 14px;
  border-bottom: 1px solid var(--border);
}

th {
  color: var(--muted);
  background: rgba(255,255,255,0.3);
}

tr:hover td {
  background: rgba(255,255,255,0.15);
}

/* =====================================================
  ðŸ”˜ PILL COUNTER
===================================================== */
.pill {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: rgba(255,255,255,0.4);
  padding: 6px 12px;
  border-radius: 999px;
  border: 1px solid var(--border);
  font-weight: 700;
  transition: 0.2s ease;
}

.pill.bump {
  animation: bump 0.25s ease;
}

@keyframes bump {
  50% { transform: scale(1.14); }
}

/* Attendance Tags */
.attendance-tag {
  font-size: 11px;
  padding: 3px 7px;
  border-radius: 999px;
}

.tag-low { background: #fee2e2; color: #b91c1c; }
.tag-mid { background: #fef3c7; color: #92400e; }
.tag-high { background: #dcfce7; color: #166534; }

/* =====================================================
  ðŸ§© MODALS
===================================================== */
.modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(15,23,42,0.55);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.modal {
  width: 100%;
  max-width: 480px;
  padding: 22px;
  border-radius: 16px;
  background: var(--card);
  border: 1px solid var(--border);
  box-shadow: var(--shadow-soft);
}

/* =====================================================
  ðŸ“± RESPONSIVE
===================================================== */
@media (max-width:720px){
  th:nth-child(1), td:nth-child(1),
  th:nth-child(3), td:nth-child(3) {
    display: none;
  }
  .controls { flex-wrap: wrap; }
}
</style>
</head>

<body>

<div class="app">
  <div class="card">

    <!-- HEADER -->
    <header style="display:flex; justify-content:space-between; align-items:flex-start; gap:16px;">
      <div>
        <div class="badge-chip">ðŸ§® Smart Attendance</div>
        <h1>Attendance Admin Panel</h1>
        <p class="lead">Manage student attendance locally in your browser.</p>
      </div>

      <div class="controls">
        <button class="btn ghost" id="themeToggle">ðŸŒ™</button>
      </div>
    </header>

    <!-- SEARCH + SORT -->
    <div class="controls">
      <input id="search" type="text" placeholder="Search by ID or Name">
      <select id="sortBy">
        <option value="name_asc">Name â†‘</option>
        <option value="name_desc">Name â†“</option>
        <option value="attendance_desc">Attendance â†“</option>
        <option value="attendance_asc">Attendance â†‘</option>
        <option value="studentid_asc">Student ID â†‘</option>
      </select>
      <button class="btn ghost" id="exportCsvBtn">â¬‡ Export</button>
      <button class="btn ghost" id="openImportBtn">â¬† Import</button>
      <button class="btn primary" id="clearAllBtn">ðŸ—‘ Clear</button>
    </div>

    <!-- ADD STUDENT -->
    <form id="addForm" style="display:flex; gap:10px; margin-top:16px;">
      <input id="studentIdInput" type="text" placeholder="Student ID" required>
      <input id="nameInput" type="text" placeholder="Full Name" required>
      <button class="btn primary" type="submit">ï¼‹ Add</button>
    </form>

    <!-- TABLE -->
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>#</th><th>ID</th><th>Name</th><th>Attendance</th><th>Action</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

  </div>
</div>

<!-- EDIT MODAL -->
<div id="modal" class="modal-backdrop">
  <div class="modal">
    <h3>Edit Student</h3>
    <form id="editForm">
      <input id="editStudentId" style="margin-top:10px;" type="text" required>
      <input id="editName" style="margin:10px 0;" type="text" required>
      <div style="display:flex; gap:10px; justify-content:flex-end;">
        <button type="button" id="modalCancel" class="btn ghost">Cancel</button>
        <button type="submit" id="modalSave" class="btn primary">Save</button>
      </div>
    </form>
  </div>
</div>

<!-- IMPORT MODAL -->
<div id="importModal" class="modal-backdrop">
  <div class="modal">
    <h3>Import CSV</h3>
    <textarea id="csvArea" style="width:100%; height:100px; margin-top:12px;"></textarea>
    <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:14px;">
      <button class="btn ghost" id="importCancel">Cancel</button>
      <button class="btn primary" id="doImportBtn">Import</button>
    </div>
  </div>
</div>

<script>
/* ==========================================================
  JAVASCRIPT â€” Attendance System + Dark Theme + Modals
========================================================== */
(() => {
  const $ = id => document.getElementById(id);

  const STORAGE_KEY = "attendance_data_v1";
  const THEME_KEY = "theme_mode";

  function uuid() {
    // Fallback if crypto.randomUUID is not available
    if (crypto && crypto.randomUUID) return crypto.randomUUID();
    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, c => {
      const r = Math.random() * 16 | 0,
            v = c === "x" ? r : (r & 0x3 | 0x8);
      return v.toString(16);
    });
  }

  let students = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");

  const tbody = $("tbody");
  const addForm = $("addForm");
  const studentIdInput = $("studentIdInput");
  const nameInput = $("nameInput");
  const searchInput = $("search");
  const sortBy = $("sortBy");
  const openImportBtn = $("openImportBtn");
  const importModal = $("importModal");
  const csvArea = $("csvArea");
  const importCancel = $("importCancel");
  const doImportBtn = $("doImportBtn");
  const clearAllBtn = $("clearAllBtn");
  const exportCsvBtn = $("exportCsvBtn");
  const modal = $("modal");
  const editForm = $("editForm");
  const editStudentId = $("editStudentId");
  const editName = $("editName");
  const modalCancel = $("modalCancel");
  const themeToggle = $("themeToggle");

  let editingId = null;

  /* ======================= THEME ======================= */
  function applyTheme(mode) {
    document.documentElement.classList.toggle("dark", mode === "dark");
    themeToggle.textContent = mode === "dark" ? "â˜€ï¸" : "ðŸŒ™";
  }

  let savedTheme = localStorage.getItem(THEME_KEY) || "light";
  applyTheme(savedTheme);

  themeToggle.onclick = () => {
    savedTheme = savedTheme === "light" ? "dark" : "light";
    localStorage.setItem(THEME_KEY, savedTheme);
    applyTheme(savedTheme);
  };

  /* ======================= HELPERS ======================= */
  function escapeHtml(s) {
    return s.replace(/[<>&"]/g, c => (
      { "<":"&lt;", ">":"&gt;", "&":"&amp;", "\"":"&quot;" }[c]
    ));
  }

  function tag(count) {
    if (count < 5) return '<span class="attendance-tag tag-low">Low</span>';
    if (count < 15) return '<span class="attendance-tag tag-mid">Medium</span>';
    return '<span class="attendance-tag tag-high">High</span>';
  }

  /* ======================= RENDER ======================= */
  function render() {
    const q = searchInput.value.toLowerCase();

    let list = students.filter(s =>
      s.student_id.toLowerCase().includes(q) ||
      s.name.toLowerCase().includes(q)
    );

    const sort = sortBy.value;
    list.sort((a,b) => {
      if (sort === "name_asc") return a.name.localeCompare(b.name);
      if (sort === "name_desc") return b.name.localeCompare(a.name);
      if (sort === "attendance_desc") return b.attendance_count - a.attendance_count;
      if (sort === "attendance_asc") return a.attendance_count - b.attendance_count;
      if (sort === "studentid_asc") return a.student_id.localeCompare(b.student_id);
      return 0;
    });

    tbody.innerHTML = list.map((s,i)=>`
      <tr>
        <td>${i+1}</td>
        <td>${escapeHtml(s.student_id)}</td>
        <td>${escapeHtml(s.name)}</td>
        <td>
          <button class="pill" onclick="window.incrementAttendance('${s.id}')">
            ${s.attendance_count} ${tag(s.attendance_count)}
          </button>
        </td>
        <td>
          <button class="btn" onclick="window.editStudent('${s.id}')">Edit</button>
          <button class="btn primary" style="background:#ef4444" onclick="window.deleteStudent('${s.id}')">Delete</button>
        </td>
      </tr>
    `).join("");
  }

  /* ======================= ACTIONS ======================= */
  window.incrementAttendance = id => {
    let s = students.find(x=>x.id===id);
    if (!s) return;
    s.attendance_count++;
    localStorage.setItem(STORAGE_KEY, JSON.stringify(students));
    render();
  };

  window.editStudent = id => {
    editingId = id;
    let s = students.find(x=>x.id===id);
    if (!s) return;
    editStudentId.value = s.student_id;
    editName.value = s.name;
    modal.style.display = "flex";
  };

  window.deleteStudent = id => {
    if (!confirm("Delete this student?")) return;
    students = students.filter(s=>s.id!==id);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(students));
    render();
  };

  modalCancel.onclick = () => {
    modal.style.display = "none";
    editingId = null;
  };

  editForm.onsubmit = e => {
    e.preventDefault();
    let s = students.find(x=>x.id===editingId);
    if (!s) return;
    s.student_id = editStudentId.value.trim();
    s.name = editName.value.trim();
    localStorage.setItem(STORAGE_KEY, JSON.stringify(students));
    modal.style.display = "none";
    editingId = null;
    render();
  };

  /* ======================= ADD STUDENT ======================= */
  addForm.onsubmit = e => {
    e.preventDefault();

    const idVal = studentIdInput.value.trim();
    const nameVal = nameInput.value.trim();
    if (!idVal || !nameVal) return;

    students.push({
      id: uuid(),
      student_id: idVal,
      name: nameVal,
      attendance_count: 0
    });

    localStorage.setItem(STORAGE_KEY, JSON.stringify(students));

    studentIdInput.value = "";
    nameInput.value = "";
    render();
  };

  /* ======================= CSV EXPORT ======================= */
  exportCsvBtn.onclick = () => {
    const csv = ["student_id,name,attendance_count"]
      .concat(students.map(s => `${s.student_id},${s.name},${s.attendance_count}`))
      .join("\n");

    const a = document.createElement("a");
    a.href = "data:text/csv," + encodeURIComponent(csv);
    a.download = "students.csv";
    a.click();
  };

  /* ======================= CSV IMPORT ======================= */
  openImportBtn.onclick = () => {
    csvArea.value = "";
    importModal.style.display = "flex";
  };

  importCancel.onclick = () =>
    importModal.style.display = "none";

  doImportBtn.onclick = () => {
    const text = csvArea.value.trim();
    if (!text) {
      importModal.style.display = "none";
      return;
    }
    const rows = text.split("\n").map(r=>r.split(","));
    rows.forEach(r => {
      if (r.length < 3) return;
      const [id, name, count] = r;
      students.push({
        id: uuid(),
        student_id: (id || "").trim(),
        name: (name || "").trim(),
        attendance_count: Number(count) || 0
      });
    });
    localStorage.setItem(STORAGE_KEY, JSON.stringify(students));
    importModal.style.display = "none";
    render();
  };

  /* CLEAR */
  clearAllBtn.onclick = () => {
    if (!confirm("Clear ALL data?")) return;
    students = [];
    localStorage.setItem(STORAGE_KEY, JSON.stringify([]));
    render();
  };

  /* SEARCH / SORT LIVE */
  searchInput.addEventListener("input", render);
  sortBy.addEventListener("change", render);

  /* INITIAL RENDER */
  render();
})();
</script>

</body>
</html>
